{"version":3,"sources":["../src/postaffiliate.js"],"names":["PostAffiliatePro","urlServer","urlLogin","username","password","options","cookies","session","axios","get","requestSession","headers","split","replace","bodyFormData","FormData","fields","push","append","JSON","stringify","method","url","data","getBuffer","getHeaders","login","join","__parseResult","o","length","getValue","__authentication","S","response","result","rows","returnData","returnFields","key","tmpItem","keyHeader","value","forEach","field","name","__getAPI","console","log","offset","limit","command","campaigns","categoryid","coupons","datestart","dateend","status","report","campaignid","deeplink"],"mappings":"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","sourcesContent":["import \"@babel/polyfill/noConflict\";\n\nimport axios from \"axios\";\nimport FormData from \"form-data\";\n\nexport default class PostAffiliatePro {\n  constructor(urlServer, urlLogin, username, password, options) {\n    this.urlServer = urlServer;\n    this.urlLogin = urlLogin;\n    this.username = username;\n    this.password = password;\n    this.cookies = null;\n    this.session = null;\n    this.options = (options) ? options : [[\"rememberMe\", \"Y\"], [\"language\", \"fr-FR\"]];\n  }\n\n  async __getSession() {\n    let requestSession = await axios.get(this.urlLogin);\n    this.session = requestSession.headers[\"set-cookie\"][0].split(\";\")[0].replace(\"A=\", \"\");\n    return this.session;\n  }\n\n  async __authentication() {\n    let bodyFormData = new FormData();\n    //if (!this.session)\n    //await this.__getSession();\n\n    let fields = [[\"name\", \"value\"], [\"username\", this.username], [\"password\", this.password]];\n    if (this.options) {\n      fields.push(...this.options);\n    }\n    bodyFormData.append(\"D\", JSON.stringify({\n      \"C\": \"Gpf_Rpc_Server\",\n      \"M\": \"run\",\n      \"requests\": [{\n        \"C\": \"Gpf_Api_AuthService\",\n        \"M\": \"authenticate\",\n        \"fields\": fields\n      }]\n    }));\n\n    let login = await axios({\n      method: \"POST\",\n      url: this.urlServer,\n      data: bodyFormData.getBuffer(),\n      headers: {\n        ...bodyFormData.getHeaders()\n      }\n    });\n\n    this.cookies = login.headers[\"set-cookie\"].join(\";\");\n    let o = await this.__parseResult(login.data);\n    if (o.fields && o.fields.length > 0) {\n      this.session = await this.getValue(o.fields, \"S\");\n    }\n\n    return true;\n  }\n\n  async __getAPI(data) {\n    if (!this.cookies)\n      await this.__authentication();\n\n    data.S = this.session;\n\n    let bodyFormData = new FormData();\n    bodyFormData.append(\"D\", JSON.stringify(data));\n\n    let response = await axios({\n      method: \"POST\",\n      url: this.urlServer,\n      data: bodyFormData.getBuffer(),\n      headers: {\n        \"Cookie\": `A=${this.session}; ${this.cookies}`,\n        ...bodyFormData.getHeaders()\n      }\n    });\n\n    return response.data;\n  }\n\n  async __parseResult(result) {\n    if (result.length > 0) {\n      let rows = result[0].rows;\n      let fields = (result[0].fields) ? result[0].fields : null;\n      let returnData = [], returnFields = [], headers = [];\n\n      for (let key in rows) {\n        if (key == 0) headers = rows[0];\n        else {\n          let tmpItem = {};\n\n          for (let keyHeader in headers)\n            tmpItem[headers[keyHeader]] = rows[key][keyHeader];\n\n          returnData.push(tmpItem);\n        }\n      }\n\n      if (fields) {\n        for (let key in fields) {\n          if (key == 0) headers = fields[0];\n          else {\n            let tmpItem = {};\n\n            for (let keyHeader in headers)\n              tmpItem[headers[keyHeader]] = fields[key][keyHeader];\n\n            returnFields.push(tmpItem);\n          }\n        }\n      }\n\n      return {\n        data: returnData,\n        fields: returnFields\n      };\n    } else {\n      return null;\n    }\n  }\n\n  async getValue(fields, key) {\n    let value = null;\n    if (fields.length > 0) {\n      fields.forEach(function (field) {\n        if (field.name === key && field.value) {\n          value = field.value;\n        }\n      });\n    }\n    return value;\n  }\n\n  async command(data) {\n    let result = await this.__getAPI(data);\n    console.log(result);\n    if (result)\n      result = this.__parseResult(result);\n\n    return result;\n  }\n\n  async campaigns(offset, limit) {\n    let campaigns = await this.command({\n      \"C\": \"Gpf_Rpc_Server\",\n      \"M\": \"run\",\n      \"requests\": [{\n        \"C\": \"Pap_Features_Common_AffiliateCampaignsGrid\",\n        \"M\": \"getRows\",\n        \"offset\": offset,\n        \"limit\": limit,\n        \"columns\": [[\"id\"], [\"name\"], [\"description\"], [\"logourl\"], [\"banners\"], [\"longdescriptionexists\"], [\"commissionsdetails\"], [\"rstatus\"], [\"commissionsexist\"]]\n      }]\n    });\n    console.log(campaigns);\n    return campaigns.data;\n  }\n\n  async affiliates(offset, limit) {\n    let campaigns = await this.command({\n      \"C\": \"Gpf_Rpc_Server\",\n      \"M\": \"run\",\n      \"requests\": [{\n        \"C\": \"Pap_Merchants_User_TopAffiliatesGrid\",\n        \"M\": \"getRows\",\n        \"offset\": offset,\n        \"limit\": limit,\n        //\"columns\": [[\"id\"], [\"name\"], [\"description\"], [\"logourl\"], [\"banners\"], [\"longdescriptionexists\"], [\"commissionsdetails\"], [\"rstatus\"], [\"commissionsexist\"]]\n      }]\n    });\n\n    return campaigns.data;\n  }\n\n  async promo(categoryid, offset, limit) {\n    let coupons = await this.command({\n      \"C\": \"Gpf_Rpc_Server\",\n      \"M\": \"run\",\n      \"requests\": [{\n        \"C\": \"Pap_Affiliates_Promo_BannersGrid\",\n        \"M\": \"getRows\",\n        \"offset\": offset,\n        \"limit\": limit,\n        \"filters\": [[\"type\", \"IN\", \"A,E,I,T\"], [\"categoryid\", \"=\", categoryid]],\n        \"columns\": [[\"id\"], [\"destinationurl\"], [\"name\"], [\"campaignid\"], [\"campaignname\"], [\"bannercode\"], [\"bannerdirectlinkcode\"], [\"bannerpreview\"], [\"rtype\"], [\"displaystats\"], [\"channelcode\"], [\"campaigndetails\"]]\n      }]\n    });\n\n    return coupons.data;\n  }\n\n  async report(datestart, dateend, status) {\n    let report = await this.command({\n      \"C\": \"Gpf_Rpc_Server\",\n      \"M\": \"run\",\n      \"requests\": [{\n        \"C\": \"Pap_Affiliates_Reports_TrendsReport\",\n        \"M\": \"loadData\",\n        \"isInitRequest\": \"N\",\n        \"filterType\": \"trends_report\",\n        \"filters\": [[\"datetime\", \"D>=\", datestart], [\"datetime\", \"D<=\", dateend], [\"rpc\", \"=\", \"Y\"], [\"groupBy\", \"=\", \"day\"], [\"dataType1\", \"=\", \"saleCount\"], [\"dataType2\", \"=\", \"saleCommission\"], [\"rstatus\", \"IN\", status]]\n      }],\n    });\n\n    return report.data;\n  }\n\n  async deeplink(url, campaignid) {\n    let deeplink = await this.command({\n      \"C\": \"Gpf_Rpc_Server\",\n      \"M\": \"run\",\n      \"requests\": [{\n        \"C\": \"Gpf_Rpc_Server\",\n        \"M\": \"run\",\n        \"requests\": [{\n          \"C\": \"Pap_Affiliates_Promo_DynamicLink\",\n          \"M\": \"getDeeplinkCode\",\n          \"fields\": [[\"name\", \"value\"], [\"desturl\", url], [\"campaignId\", campaignid]]\n        }],\n      }],\n    });\n\n    return deeplink.fields[2].value;\n  }\n}"],"file":"postaffiliate.js"}